<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>zetonszetonszetons</title>
  <style>
    :root{ --bg:#0f1220;--card:#171a2b;--muted:#aab1c7;--text:#eef2ff;--accent:#9b87f5;--chip:#232744;--border:#252a48; }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,#0d1020 0%,#0b1022 100%);color:var(--text)}
    header{position:sticky;top:0;z-index:5;background:rgba(13,16,32,.9);backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
    .container{max-width:1100px;margin:0 auto;padding:20px}
    h1{font-weight:800;letter-spacing:.2px;margin:6px 0 2px}
    .sub{color:var(--muted);font-size:.95rem;margin-bottom:16px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    .row{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:14px 14px 10px;box-shadow:0 1px 0 rgba(255,255,255,.04),0 12px 30px rgba(0,0,0,.25)}
    .search{display:flex;gap:8px}
    input[type="search"]{flex:1;padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:#0c1023;color:var(--text);font-size:1rem;outline:none}
    button{padding:12px 14px;border-radius:12px;border:1px solid var(--border);background:linear-gradient(180deg,#23284d,#1d2143);color:#fff;font-weight:600;cursor:pointer}
    .pill{display:inline-flex;gap:8px;align-items:center;background:var(--chip);border:1px solid var(--border);padding:6px 10px;border-radius:999px;font-size:.85rem;color:var(--muted)}
    .perf{border-radius:16px;overflow:hidden}
    .perf-header{display:flex;justify-content:space-between;align-items:center;gap:10px;cursor:pointer;padding:12px 10px;border-radius:12px}
    .perf-header:hover{background:#1a1e35}
    .perf-title{display:flex;gap:10px;align-items:center}
    .num{display:inline-grid;place-items:center;width:30px;height:30px;border-radius:10px;background:#141936;border:1px solid var(--border);font-weight:700;color:var(--accent)}
    .name{font-weight:700}
    .meta{color:var(--muted);font-size:.9rem}
    .chev{transition:transform .2s ease}
    .open .chev{transform:rotate(90deg)}
    .perf-body{display:none;padding:12px;border-top:1px dashed var(--border)}
    .open + .perf-body{display:block}
    .section{margin:8px 0 4px}
    .section h4{margin:10px 0 6px;font-size:0.95rem;color:#dfe3ff;letter-spacing:.2px}
    .roles{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
    .role-card{background:#121632;border:1px solid var(--border);border-radius:12px;padding:10px}
    .role-card h5{margin:0 0 8px;font-size:.88rem;color:#c9d1ff;letter-spacing:.3px}
    .names{display:flex;flex-wrap:wrap;gap:8px}
    .names .pill{background:#0f1331}
    .desc{white-space:pre-wrap;color:#d3d8ff}
    .contacts{display:flex;flex-wrap:wrap;gap:6px}
    .muted{color:var(--muted)}
    .divider{height:1px;background:linear-gradient(90deg,transparent,#28305a,transparent);margin:10px 0}
    .actor-result{margin-top:10px}
    .actor-card{background:#121632;border:1px solid var(--border);border-radius:16px;padding:12px}
    a.btn-link{color:#bcd2ff;text-decoration:none;border-bottom:1px dashed #3e4a86}
    .spinner{width:18px;height:18px;border-radius:50%;border:3px solid #28305a;border-top-color:var(--accent);animation:spin .8s linear infinite;display:inline-block;vertical-align:middle}
    @keyframes spin{to{transform:rotate(360deg)}}
    footer{color:var(--muted);font-size:.85rem;padding:24px 0 40px;text-align:center}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>RĀVĢ Žetonvakars 2025 lomu sadalījums</h1>
      <div class="row">
        <div class="card" style="flex:1;min-width:300px">
          <form id="searchForm" class="search" autocomplete="off">
            <label class="sr-only" for="actorSearch">Meklēt pēc vārda...</label>
            <input id="actorSearch" name="actor" type="search" placeholder="Meklēt pēc vārda..." list="actorList" />
            <datalist id="actorList"></datalist>
            <button id="searchBtn" type="submit">Meklēt</button>
          </form>
          <div id="actorResult" class="actor-result"></div>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <div id="status" class="muted"><span class="spinner"></span> Loading…</div>
    <div id="perfList" class="grid" aria-live="polite"></div>
  </main>

  <footer>
  </footer>

  <!-- The bundler injects the CSVs here as JSON so the page works offline with file:// -->
  <script id="EMBEDDED_DATA" type="application/json">{"mode": "csv-embedded", "grafiksCsv": "﻿Order;Performance name;Description;Contacts\n1;Leijerkastnieks;Pirmā reize skolas pagalmā 1. septembrī, J. Purviņa hor. Piedziedājuma laikā pievienojas galvenie aktieri, tiek uzstādīta scenogrāfija. ;Vilis (25142312)\n2;1. septembra uzruna;Statisks masas izvietojums + uzruna;Beatrise (20282084) un Vilis (25142312)\n3;Es jums saku: dziediet!;Epifānija;Beatrise (20282084)\n4;Četri balti krekli;Burzma garajā starpbrīdī vestibilā, Nikolas hor.;Vilis (25142312)\n5;Foajē aina;Tiek izlemts, kādus pulciņus galvenie varoņi apmeklē;Beatrise (20282084)\n6;Popūrijs;Kora mēģinājums;Kristīne (26470894)\n7;Volejbols;Aerobisks iestudējums par volejbolu skolā;Vilis (25142312)\n8;KSKM;\"Deja par puišu deficītu TDK \"\"Vainags\"\" + akordeons, J. Purviņa hor.\";Vilis (25142312)\n9;Paziņojums + Nekas nav tik viegli;Dzeja + epifānija;Beatrise (20282084)\n10;Zvērs;Zvērs - Alejas;Kristīne (26470894)\n11;ZPD plānošana;top;Beatrise (20282084)\n12;ZPD prezentēšana;top;Beatrise (20282084)\n13;Milžu cīņa;Milžu cīņa - Dzeltenie pastnieki;Kristīne (26470894)\n14;No kura stāva mēs runājām;Epifānija;Beatrise (20282084)\n15;Pusdienu rinda;Galvenā tēma - R. Pauls. Deja + akordeons., Katrīnas hor.;Vilis (25142312)\n16;Balle;top;Beatrise (20282084)\n17;Speed dating;top;Beatrise (20282084)\n18;Skumjas;Laikmetīgā deja, Emmas hor.;Emma (28622267)\n19;Lai dzīvo bērni;\"K. Ēcis \"\"lai dzīvo bērni\"\"\";Beatrise (20282084)\n20;Mīlestības jūra;Dziesma + deja, Megijas hor.;Kristīne (26470894) un Vilis (25142312)\n21;Skrūvatslēga pārsita cilvēkam galvu;Epifānija;Beatrise (20282084)\n22;Dzīve kā košums;japadzied;Kristīne (26470894)\n23;Atvadas;A. Daņiļeviča hor.;Vilis (25142312)\n24;Noslēdzošā aina;top;Beatrise (20282084)\n25;Tāpēc jau...;R. Pauls, I. Ziedonis. Dziesmas laikā visi dziedot pamazām savācas uz tribīnēm.;Kristīne (26470894) un Vilis (25142312)\n26;Dzeguzes balss;I. Kalniņš, M. Čaklais;Kristīne (26470894)\n-;Grupa;;Kristīne (26470894)\n-;Rekvizīti;;\n", "dalibniekiCsv": "﻿Actor;Perf1;Role1;Perf2;Role2;Perf3;Role3;Perf4;Role4;Perf5;Role5;Perf6;Role6;Perf7;Role7;;;;;;;;\nEgita Strazdiņa (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;KSKM;dejo;;;;;;;;;;;;;;\nGabriela Nadricka (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Skumjas;dejo;Zvērs;dejo;;;;;;;;;;;;;;\nKate Zēberga (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;;;;;;;;;;;;;;\nAnna Vidzemniece (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;;;;;;;;;;\nToms Zvejnieks (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;Atvadas;dejo;Paziņojums + Nekas nav tik viegli;aktieris;No kura stāva mēs runājām;aktieris;Skrūvatslēga pārsita cilvēkam galvu;aktieris;;;;;;;;\nBeāte Žavnere (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;;;;;;;;;;;;;;;;\nEmma Ņestrojeva (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Atvadas;dejo;Speed dating;aktieris;Skumjas;dejo;Popūrijs;dzied;;;;;;;;;;\nHenrijs Ašmanis (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Popūrijs;aktieris;;;;;;;;;;;;;;\nRihards Smilga (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Zvērs;aktieris;No kura stāva mēs runājām;aktieris;;;;;;;;;;;;;;\nReinis (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Skumjas;dejo;Atvadas;dejo;;;;;;;;;;;;\nAndrejs Bendrāts (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Volejbols;dejo;;;;;;;;;;;;;;;;\nAnnija Amanda Zustare (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;KSKM;aktieris;Dzīve kā košums;dzied;;;;;;;;;;\nLukas Krīgers (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;;;;;;;;;;;;;;;;\nLinda Zandberga (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;;;;;;;;;;;;;;\nAgate Ozoliņa (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Volejbols;dejo;Popūrijs;dzied;Rekvizīti;rekviziti;;;;;;;;;;;;\nKristaps Lācis (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;Popūrijs;dzied;;;;;;;;;;;;;;\nKristians Jānis Janovskis (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;;;;;;;;;;;;;;;;\nĒriks Nikolajevs (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Rekvizīti;rekviziti;;;;;;;;;;;;;;\nIvans Ņikitins (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;;;;;;;;;;;;\nNellija Kārkliņa (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;;;;;;;;;;\nDaniels Ramiņš (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Rekvizīti;rekviziti;;;;;;;;;;;;;;\nHarijs Meisters (a);;;;;;;;;;;;;;;;;;;;;;\nRoberts (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;1. septembra uzruna;masu skati;Pusdienu rinda;dejo;;;;;;;;;;;;\nArtūrs (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Rekvizīti;rekviziti;;;;;;;;;;;;;;\nGustavs Smiltens (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;;;;;;;;;;;;\nReinis Apaļko (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Skumjas;dejo;;;;;;;;;;;;;;\nKārlis Liepiņš (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;;;Speed dating;aktieris;Skumjas;dejo;;;;;;;;;;;;\nLukass Podziava (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;;;;;;;;;;;;;;;;\nArmands Matrēvics (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;1. septembra uzruna;masu skati;Pusdienu rinda;dejo;;;;;;;;;;;;\nKristers Celitāns (a);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;1. septembra uzruna;masu skati;Pusdienu rinda;dejo;;;;;;;;;;;;\nKatrīna Augustāne (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;;;;;;;;;;;;;;;;\nAmanda Elksne (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;;;;;;;;;;;;;;;;\nRenārs Puriņš (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;Grupa;grupa;Zvērs;dzied;;;;;;;;;;\nDinija (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Volejbols;dejo;;;;;;;;;;;;;;;;\nEndija Krampāne (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Volejbols;dejo;1. septembra uzruna;aktieris;;;;;;;;;;;;;;\nAleksandra Kirita (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Skumjas;dejo;Zvērs;dejo;;;;;;;;;;;;;;\nEmīlija Kociņa (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Skumjas;dejo;Zvērs;dejo;;;;;;;;;;;;;;\nKatrīna Zariņa (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Skumjas;dejo;Zvērs;dejo;;;;;;;;;;;;;;\nMelisa (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Rekvizīti;rekviziti;Skumjas;dejo;;;;;;;;;;;;;;\nAmēlija Kuļikovska (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Skumjas;dejo;;;;;;;;;;;;;;;;\nRalfs Klaužs (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;;;;;;;;;;;;;;\nElīza Seredņakova (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;Volejbols;aktieris;;;;;;;;\nEmma Emīlija (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Skumjas;dejo;KSKM;dejo;;;;;;;;;;;;;;\nLuīze Zagorska (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;;;;;;;;;;;;;;;;\nkristiana simane (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;;;;;;;;;;;;;;;;\nEvelīna Senkēviča (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;;;;;;;;;;;;;;;;\nMišele (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Volejbols;aktieris;;;;;;;;;;;;;;\nLīva Liepa (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;;;;;;;;;;;;;;\nKristiāna Stabulniece (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Skumjas;dejo;ZPD prezentēšana;aktieris;Zvērs;dejo;;;;;;;;;;;;\nJēkabs Reķis (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;;;;;;;;;;;;\nZelma Grīvane (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;;;;;;;;;;;;;;;;\nJusts Ansis Puļķis (b);Tāpēc jau...;dzied;Dzeguzes balss;dzied;;;Rekvizīti;rekviziti;;;;;;;;;;;;;;\nRūdis Kupčs (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;Atvadas;dejo;KSKM;dejo;;;;;;;;;;;;\nLīna Upeniece (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Volejbols;dejo;Popūrijs;dzied;Mīlestības jūra;dzied;;;;;;;;;;;;\nAnce Madara Joasa (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;KSKM;dejo;;;;;;;;;;;;;;\nAmanda Reilija Zariņa (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;;;;;;;;;;;;\nAlise Smirnova (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Skumjas;dejo;Rekvizīti;rekviziti;;;;;;;;;;;;;;\nRebeka Neimame (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Skumjas;dejo;;;;;;;;;;;;;;;;\nAnce Simonova (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;KSKM;dejo;Popūrijs;dzied;;;;;;;;;;;;\nBeāte (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;KSKM;dejo;;;;;;;;;;;;;;\nKristiāna Tidomane (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;KSKM;dejo;Pusdienu rinda;dejo;;;;;;;;;;;;;;\nNora Bobule (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;;;;;;;;;;\nKristīne Daugule (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;Zvērs;dejo;Milžu cīņa;dzied;Skumjas;dzied;;;;;;;;\nAnnemarija Puķīte (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;KSKM;dejo;Milžu cīņa;dzied;;;;;;;;;;\nKristiāna Cekula (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;Popūrijs;dzied;;;;;;;;\nDaniels (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Speed dating;aktieris;;;;;;;;;;;;;;\nGrēta Dilāne (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Rekvizīti;rekviziti;Foajē aina;aktieris;Volejbols;aktieris;Pusdienu rinda;aktieris;Lai dzīvo bērni;aktieris;;;;;;;;\nKarolīna Rošā (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;Popūrijs;dzied;;;;;;;;\nAnete Paršāne (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;KSKM;dejo;Zvērs;dejo;;;;;;;;;;;;;;\nRūdolfs (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Grupa;grupa;;;;;;;;;;;;;;;;\nKatrīna Krūmiņa (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Atvadas;dejo;Pusdienu rinda;dejo;;;;;;;;;;;;;;\nAnete Guļāne (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;;;;;;;;;;\nMāris Šķerbergs (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;1. septembra uzruna;masu skati;;;;;;;;;;;;;;\nAgate Vanaga (c);Tāpēc jau...;dzied;Dzeguzes balss;dzied;KSKM;dejo;Pusdienu rinda;dejo;;;;;;;;;;;;;;\nMegija Savicka (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;KSKM;dejo;Atvadas;dejo;;;;;;;;;;;;\nSigne Šilova (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;;;;;;;;;;\nMarta Blumentale (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;;;;;;;;;;\nAnnemarija Šorubalko (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Rekvizīti;rekviziti;Volejbols;dejo;;;;;;;;;;;;;;\nMarta Gabriela Peiča (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Skumjas;dejo;Četri balti krekli;masu skati;Zvērs;dejo;;;;;;;;;;;;\nAndrejs Linkevičs (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;Volejbols;dejo;;;;;;;;;;;;;;\nOskars (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Volejbols;aktieris;;;;;;;;;;;;;;;;\nAnete Andersone (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;;;;;;;;;;\nUna Gailīte (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;KSKM;dejo;Popūrijs;dzied;;;;;;;;;;;;\nMarta Evelīna Tuča (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;Četri balti krekli;masu skati;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;;;;;;;;\nNikola Pirtnieka (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;KSKM;dejo;Atvadas;dejo;;;;;;;;;;;;\nAdele Brēķe (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;;;;;;;;;;;;\nLaura Žurzdiņa (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Speed dating;aktieris;Mīlestības jūra;dzied;;;;;;;;;;;;\nDāvids Osovskis (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;1. septembra uzruna;masu skati;Pusdienu rinda;masu skati;;;;;;;;;;;;\nTeodors Pekšēns (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Skumjas;dejo;;;;;;;;;;;;;;;;\nAlberts (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Foajē aina;aktieris;Popūrijs;aktieris;KSKM;aktieris;Pusdienu rinda;aktieris;Lai dzīvo bērni;aktieris;Noslēdzošā aina;aktieris;;;;;;\nRūdolfs Skulte (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Skumjas;dejo;Volejbols;dejo;;;;;;;;;;;;;;\nSandija Opincāne (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;KSKM;dejo;Popūrijs;dzied;Mīlestības jūra;dzied;Dzīve kā košums;dzied;;;;;;;;;;\nGabriels Civjans (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;Rekvizīti;rekviziti;;;;;;;;;;;;\nKnuts (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;Popūrijs;aktieris;Balle;aktieris;;;;;;;;;;\nEdvards Liepiņš (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;1. septembra uzruna;masu skati;;;;;;;;;;;;\nGusts Matīss Puļķis (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;1. septembra uzruna;masu skati;;;;;;;;;;;;\nRoberts Šūtavs (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Volejbols;dejo;;;;;;;;;;;;;;;;\nToms Blumbergs (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;;;;;;;;;;;;;;;;\nArtūrs Gailis (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Rekvizīti;rekviziti;;;;;;;;;;;;;;;;\nVilis (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;Atvadas;dejo;;;;;;;;;;;;;;\nTomass Gerhards (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Skumjas;dejo;;;;;;;;;;;;;;;;\nteodora elza pjatkina (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;;;;;;;;;;\nKeitija Inga Losberga (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;Rekvizīti;rekviziti;;;;;;;;;;;;\nVeilands-Kustikovs Alfrēds (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;;;;;;;;;;\nAnna Birzniece (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;;;;;;;;;;\nArellino :D (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;Rekvizīti;rekviziti;;;;;;;;;;;;\nElina Blumberga (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;Foajē aina;aktieris;ZPD prezentēšana;aktieris;Pusdienu rinda;aktieris;Lai dzīvo bērni;aktieris;Noslēdzošā aina;aktieris;Zvērs;dejo;Dzīve kā košums;dzied\nEduards Zilberts (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;Rekvizīti;rekviziti;Foajē aina;aktieris;Pusdienu rinda;aktieris;Speed dating;aktieris;Lai dzīvo bērni;aktieris;Noslēdzošā aina;aktieris;Dzīve kā košums;dzied\nKatrīna Vālodze (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;;;;;;;;;;;;;;\nRamona (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;;;;;;;;;;;;;;;;\nGrieta Gauja (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;Rekvizīti;rekviziti;ZPD plānošana;aktieris;Skrūvatslēga pārsita cilvēkam galvu;aktieris;Dzīve kā košums;dzied;;;;;;\nPatrīcija Aizbalte (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;;;;;;;;;;;;;;;;\nElvisa Švandere (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;;;;;;;;;;;;;;;;\nUna Kalniņa-Malzubre (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;;;;;;;;;;\nKate Kivriņa (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;Četri balti krekli;masu skati;Dzīve kā košums;dzied;;;;;;;;;;\nPatrīcija Dārta Klīve (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Rekvizīti;rekviziti;Četri balti krekli;masu skati;;;;;;;;;;;;\nAnda Vismane (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;KSKM;dejo;Popūrijs;dzied;;;;;;;;;;;;;;\nMadara Barone (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Rekvizīti;rekviziti;Popūrijs;dzied;Mīlestības jūra;dzied;Četri balti krekli;;Dzīve kā košums;dzied;;;;;;;;\nPatrīcija Paožole (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Rekvizīti;rekviziti;;;;;;;;;;;;;;;;\nMadara Ladiga (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;Popūrijs;dzied;;;;;;;;\nKate (e);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;ZPD plānošana;aktieris;No kura stāva mēs runājām;aktieris;Skrūvatslēga pārsita cilvēkam galvu;aktieris;Dzīve kā košums;dzied;;;;;;\nRodrigo Pelnēns (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;1. septembra uzruna;masu skati;;;;;;;;;;;;\nIvo (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;KSKM;dejo;Popūrijs;dzied;Mīlestības jūra;dzied;Dzīve kā košums;dzied;;;;;;;;\nAnna Lāce (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;Popūrijs;dzied;Mīlestības jūra;dzied;Popūrijs;aktieris;Četri balti krekli;dzied;Dzīve kā košums;dzied;;;;;;\nĒriks Zaics (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;1. septembra uzruna;masu skati;;;;;;;;;;;;\nEstere Kuzmiča (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;;;;;;;;;;\nStella Oše (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;KSKM;dejo;Popūrijs;dzied;Mīlestības jūra;dzied;No kura stāva mēs runājām;aktieris;Skrūvatslēga pārsita cilvēkam galvu;aktieris;Dzīve kā košums;dzied;;;;;;\nRūta Zvidriņa (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Rekvizīti;rekviziti;;;;;;;;;;;;;;\nMelānija Marta Kantiševa (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;;;;;;;;;;;;;;\nMaija Marija Bakinovska (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Volejbols;aktieris;;;;;;;;;;;;;;;;\nElīza Tomaševica (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;Dzīve kā košums;dzied;;;;;;;;;;;;\nSindija Brante (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;1. septembra uzruna;masu skati;;;;;;;;;;;;\nNikola Sprūga (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Leijerkastnieks;dejo;Popūrijs;dzied;Speed dating;aktieris;Mīlestības jūra;dzied;;;;;;;;;;\nUlrihs Harmsens (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Grupa;grupa;Mīlestības jūra;dzied;;;;;;;;;;;;;;\nErnests (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;1. septembra uzruna;masu skati;ZPD prezentēšana;aktieris;Zvērs;dejo;;;;;;;;\nDarens Ozols (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;1. septembra uzruna;masu skati;;;;;;;;;;;;\nAdrians Sēja (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;;;;;;;;;;;;;;;;;;\nNatāns Krsatiņš (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;ZPD prezentēšana;aktieris;Zvērs;dejo;Mīlestības jūra;dzied;Četri balti krekli;dzied;Dzīve kā košums;dzied;;;;;;\nMarkuss Podinskis (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;1. septembra uzruna;masu skati;;;;;;;;;;;;\nRihards Kuklis (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;1. septembra uzruna;masu skati;;;;;;;;;;;;\nLote Ermane (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;1. septembra uzruna;masu skati;;;;;;;;;;;;\nZīle Cālīte (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra;dzied;Četri balti krekli;dzied;Dzīve kā košums;dzied;;;;;;;;;;\nJēkabs Čodars (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;1. septembra uzruna;masu skati;;;;;;;;;;;;\nRonalds Borins (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;1. septembra uzruna;masu skati;;;;;;;;;;;;\nElza Caune (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;;;;;;;;;;;;;;;;;;\nReinis Jaksts (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;Rekvizīti;rekviziti;1. septembra uzruna;masu skati;;;;;;;;;;\nPēteris Celmiņš (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;aktieris;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;1. septembra uzruna;masu skati;;;;;;;;;;\nEmīlija Teice (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;1. septembra uzruna;masu skati;;;;;;;;;;;;\nAlens Briņķis (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;Mīlestības jūra;masu skati;1. septembra uzruna;masu skati;;;;;;;;;;;;\nEduards (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Volejbols;dejo;;;;;;;;;;;;;;;;\nKrišjānis I. (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Četri balti krekli;masu skati;1. septembra uzruna;masu skati;;;;;;;;;;;;;;\nKristaps Smirnovs (d);Tāpēc jau...;dzied;Dzeguzes balss;dzied;;;;;;;;;;;;;;;;;;\nMariss Ozols (f);Tāpēc jau...;dzied;Dzeguzes balss;dzied;Popūrijs;dzied;Mīlestības jūra ;dzied;;;;;;;;;;;;;;\n"}</script>

<script>
// === State ===
let actorToAssignments = new Map();
let perfMetaByName = new Map();
let rolesByPerformance = new Map();

// === Utils ===
const slug = s => String(s||'').toLowerCase()
  .normalize('NFD').replace(/\p{Diacritic}/gu,'')
  .replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
function ensure(map, key, init){ if(!map.has(key)) map.set(key, typeof init==='function'?init():init); return map.get(key); }
function createEl(tag, opts={}){ const el=document.createElement(tag); if(opts.class) el.className=opts.class; if(opts.text!=null) el.textContent=opts.text; if(opts.html!=null) el.innerHTML=opts.html; if(opts.attrs){ for(const [k,v] of Object.entries(opts.attrs)) el.setAttribute(k,v)} return el; }
function sortedRolesMap(roleMap){ const entries=Array.from(roleMap.entries()).map(([role,set])=>[role,Array.from(set).sort((a,b)=>a.localeCompare(b,'lv'))]); entries.sort((a,b)=>a[0].localeCompare(b[0],'lv')); return entries; }

// --- CSV parsing (auto-detect semicolon vs comma) ---
function parseCSV(text){
  const firstLine = (text.split(/\r?\n/)[0]||'');
  const delim = (firstLine.split(';').length > firstLine.split(',').length) ? ';' : ',';
  const rows=[]; let cur=[], field='', inQuotes=false;
  for(let i=0;i<text.length;i++){
    const ch=text[i], next=text[i+1];
    if(inQuotes){
      if(ch==='"'){
        if(next==='"'){ field+='"'; i++; } else { inQuotes=false; }
      } else { field+=ch; }
    } else {
      if(ch==='"') inQuotes=true; else if(ch===delim){ cur.push(field); field=''; }
      else if(ch==='\n'){ cur.push(field); rows.push(cur); cur=[]; field=''; }
      else if(ch==='\r'){ } else { field+=ch; }
    }
  }
  cur.push(field); rows.push(cur); return rows;
}

// === Rendering ===
function renderFileInfo(){
  const box = document.getElementById('fileInfo');
  if (!box) return; // safely do nothing
}

function renderActorList(){
  const list = document.getElementById('actorList');
  list.replaceChildren();
  const names = Array.from(actorToAssignments.keys()).sort((a,b)=>a.localeCompare(b,'lv'));
  for(const n of names){ const opt=document.createElement('option'); opt.value=n; list.appendChild(opt); }
}

function renderPerformances(){
  const target = document.getElementById('perfList'); target.replaceChildren();
  const perfs = Array.from(perfMetaByName.values()).sort((a,b)=>{ const ao=Number(a.order)||999999, bo=Number(b.order)||999999; return ao-bo || a.name.localeCompare(b.name,'lv'); });
  for(const meta of perfs){
    const perfKey = meta.name; const perfId = 'perf-'+slug(perfKey);
    const wrap = createEl('div',{class:'perf card'});
    const header = createEl('div',{class:'perf-header', attrs:{role:'button','aria-expanded':'false','aria-controls':perfId, tabindex:0}});
    const body = createEl('div',{class:'perf-body', attrs:{id:perfId}});
    header.addEventListener('click',()=>togglePerf(header, body));
    header.addEventListener('keydown',e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); togglePerf(header, body);} });
    const title = createEl('div',{class:'perf-title'});
    title.append(createEl('div',{class:'num', text:String(meta.order??'')}), createEl('div',{html:`<div class="name">${meta.name||'Unnamed performance'}</div><div class="meta">Spied, lai redzētu detaļas</div>`}));
    const chev = createEl('div',{class:'chev', html:'▶'}); header.append(title,chev);
    const desc = createEl('div',{class:'section'}); desc.append(createEl('h4',{text:'Apraksts'}), createEl('div',{class:'desc', text: meta.desc || '—'}));
    const contacts = createEl('div',{class:'section'}); contacts.append(createEl('h4',{text:'Atbildīgās personas'}));
    const people = String(meta.contacts||'').split(/[\,\n;]/).map(s=>s.trim()).filter(Boolean);
    const contWrap = createEl('div',{class:'contacts'}); if(people.length===0) contWrap.append(createEl('span',{class:'muted',text:'—'})); for(const p of people){ contWrap.append(createEl('span',{class:'pill',text:p})); } contacts.append(contWrap);
    const roleSec = createEl('div',{class:'section'}); roleSec.append(createEl('h4',{text:'Dalībnieki'}));
    const roleWrap = createEl('div',{class:'roles'}); const roleMap = rolesByPerformance.get(perfKey) || new Map();
    if(roleMap.size===0){ roleWrap.append(createEl('div',{class:'muted',text:'No assignments in DALIBNIEKI for this performance.'})); }
    else { for(const [role,names] of sortedRolesMap(roleMap)){ const rc=createEl('div',{class:'role-card'}); rc.append(createEl('h5',{text:role.toUpperCase()})); const nwrap=createEl('div',{class:'names'}); for(const n of names){ nwrap.append(createEl('span',{class:'pill',text:n})); } rc.append(nwrap); roleWrap.append(rc);} }
    roleSec.append(roleWrap);
    body.append(desc, createEl('div',{class:'divider'}), contacts, createEl('div',{class:'divider'}), roleSec);
    wrap.append(header, body); target.appendChild(wrap);
  }
}

function togglePerf(header, body){
  const isOpen = header.classList.toggle('open'); header.setAttribute('aria-expanded', String(isOpen));
  if(isOpen){ document.querySelectorAll('.perf-header.open').forEach(h=>{ if(h!==header){ h.classList.remove('open'); h.setAttribute('aria-expanded','false'); }}); document.querySelectorAll('.perf-body').forEach(b=>{ if(b!==body) b.style.display='none'; }); }
  body.style.display = isOpen? 'block':'none';
}

function renderActorResult(name){
  const box=document.getElementById('actorResult'); box.replaceChildren(); const card=createEl('div',{class:'actor-card'});
  card.append(createEl('div',{html:`<strong>${name}</strong>`}));
  const list = actorToAssignments.get(name)||[];
  if(list.length===0){ card.append(createEl('div',{class:'muted',text:'No assignments found.'})); }
  else { const ul=createEl('ul'); list.sort((a,b)=>{ const A=perfMetaByName.get(a.performance)?.order??999999; const B=perfMetaByName.get(b.performance)?.order??999999; return A-B || a.performance.localeCompare(b.performance,'lv') || a.role.localeCompare(b.role,'lv'); });
    for(const it of list){ const li=createEl('li'); const pmeta=perfMetaByName.get(it.performance)||{name:it.performance,order:''}; const link=createEl('a',{class:'btn-link',attrs:{href:'#'},html:`#${pmeta.order} – <strong>${pmeta.name}</strong> <span class='muted'>(${it.role})</span>`}); link.addEventListener('click',e=>{e.preventDefault(); focusPerformance(it.performance);}); li.append(link); ul.append(li);} card.append(ul); }
  box.append(card);
}

function focusPerformance(perfName){ const id='perf-'+slug(perfName); const body=document.getElementById(id); if(!body) return; const header=body.previousElementSibling; if(header&&!header.classList.contains('open')) togglePerf(header, body); body.scrollIntoView({behavior:'smooth',block:'start'}); }

// === Data flow ===
function processCsvTexts(gTxt, dTxt){
  const gRows = parseCSV(gTxt); const dRows = parseCSV(dTxt);
  actorToAssignments = new Map(); perfMetaByName = new Map(); rolesByPerformance = new Map();
  for(let i=1;i<gRows.length;i++){ const r=gRows[i]; if(!r) continue; const order=r[0]; const name=(r[1]||'').trim(); if(!name) continue; const desc=r[2]||''; const contacts=r[3]||''; perfMetaByName.set(name,{order,name,desc,contacts}); }
  for(let i=1;i<dRows.length;i++){ const r=dRows[i]; if(!r) continue; const actor=(r[0]||'').trim(); if(!actor) continue; for(let c=1;c<r.length;c+=2){ const perf=(r[c]||'').trim(); const role=(r[c+1]||'').trim(); if(!perf||!role) continue; ensure(actorToAssignments,actor,()=>[]).push({performance:perf, role}); const roleMap=ensure(rolesByPerformance,perf,()=>new Map()); const set=ensure(roleMap,role,()=>new Set()); set.add(actor); if(!perfMetaByName.has(perf)) perfMetaByName.set(perf,{order:'',name:perf,desc:'',contacts:''}); } }
  renderFileInfo(); renderActorList(); renderPerformances();
  document.getElementById('status').textContent = `Loaded ${perfMetaByName.size} performances and ${actorToAssignments.size} actors.`;
}

async function loadData(){
  const status = document.getElementById('status');
  try{
    // 1) Embedded data wins (works offline, file://, email, etc.)
    const embedRaw = document.getElementById('EMBEDDED_DATA').textContent.trim();
    if(embedRaw && embedRaw !== '{}' ){
      const payload = JSON.parse(embedRaw);
      if(payload.mode === 'csv-embedded'){
        processCsvTexts(payload.grafiksCsv, payload.dalibniekiCsv);
        return;
      }
    }

    // 2) Served over http(s): fetch CSVs from same folder
    if(location.protocol.startsWith('http')){
      const [gRes, dRes] = await Promise.all([
        fetch('GRAFIKS.csv', {cache:'no-cache'}),
        fetch('DALIBNIEKI.csv', {cache:'no-cache'})
      ]);
      if(!gRes.ok) throw new Error(`Failed to fetch GRAFIKS.csv: ${gRes.status}`);
      if(!dRes.ok) throw new Error(`Failed to fetch DALIBNIEKI.csv: ${dRes.status}`);
      const [gTxt, dTxt] = await Promise.all([gRes.text(), dRes.text()]);
      processCsvTexts(gTxt, dTxt); return;
    }

    // 3) file:// fallback (no server, no embedded data): prompt for drag & drop
    status.innerHTML = 'Local file mode detected. Drag & drop your CSV files (GRAFIKS.csv and DALIBNIEKI.csv) anywhere on this page, or press Ctrl+O to choose files.';
    enableLocalPickers();
  }catch(err){
    console.error(err); status.innerHTML = `❌ Failed to load data.<br><code>${String(err)}</code>`;
  }
}

// Local-only helpers
function enableLocalPickers(){
  const body=document.body; ['dragenter','dragover'].forEach(e=>body.addEventListener(e,ev=>{ev.preventDefault(); ev.dataTransfer.dropEffect='copy';}));
  body.addEventListener('drop', async ev=>{ev.preventDefault(); const files=Array.from(ev.dataTransfer.files||[]); const g=files.find(f=>/grafiks/i.test(f.name)); const d=files.find(f=>/dalibnieki/i.test(f.name)); if(!g||!d){ document.getElementById('status').innerHTML='Please drop both <strong>GRAFIKS.csv</strong> and <strong>DALIBNIEKI.csv</strong>.'; return;} const [gTxt,dTxt]=await Promise.all([g.text(), d.text()]); processCsvTexts(gTxt, dTxt); });
  window.addEventListener('keydown',(e)=>{ if(e.ctrlKey && e.key.toLowerCase()==='o'){ e.preventDefault(); const inp=document.createElement('input'); inp.type='file'; inp.multiple=true; inp.accept='.csv'; inp.addEventListener('change', async ()=>{ const files=Array.from(inp.files||[]); const g=files.find(f=>/grafiks/i.test(f.name)); const d=files.find(f=>/dalibnieki/i.test(f.name)); if(!g||!d){ document.getElementById('status').innerHTML='Please choose both <strong>GRAFIKS.csv</strong> and <strong>DALIBNIEKI.csv</strong>.'; return;} const [gTxt,dTxt]=await Promise.all([g.text(), d.text()]); processCsvTexts(gTxt, dTxt); }); inp.click(); } });
}

// Events
window.addEventListener('DOMContentLoaded', ()=>{
  loadData();
  document.getElementById('searchForm').addEventListener('submit',(e)=>{ e.preventDefault(); const name=document.getElementById('actorSearch').value.trim(); if(!name) return; renderActorResult(name); });
});
</script>
</body>
</html>
